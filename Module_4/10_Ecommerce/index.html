<!DOCTYPE html>
    <html lang = "en">
        <head>
            <meta charset="UTF-8"/>
            <meta name="viewport" content="width=device-width, initial-scale=1.0" />
             <!-- Bootstrap CSS - This is loading the Bootstrap CSS file. -->
            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
            <!-- Bootstrap JavaScript - Enables interactive components like dropdown menus -->
             <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" defer></script>
            <title> E-commerce</title>
        </head>
        <body>
            <!--Navbar-->
            <nav class="navbar navbar-expand-lg bg-body-tertiary">
                <div class="container-fluid">
                    <a class="navbar-brand" href="#">Navbar</a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span> <!--hamburguer menu button-->
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                            <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="#">Home</a>
                            </li>
                            <li class="nav-item">
                            <a class="nav-link" href="#">Link</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    Dropdown
                                </a>
                                <ul class="dropdown-menu"> <!-- Dropdown menu items and a divider. -->
                                    <li><a class="dropdown-item" href="#">Action</a></li>
                                    <li><a class="dropdown-item" href="#">Another action</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="#">Something else here</a></li>
                                </ul>
                            </li>
                            <li class="nav-item">
                            <a class="nav-link disabled" aria-disabled="true">Disabled</a>
                            </li>
                        </ul>
                        <div class="container-fluid"> <!--cart-->
                            <a class="navbar-brand" href="#">My Shop</a>
                            <span id="cart-count" class="ms-auto">
                            ðŸ›’ Cart: 0
                            </span>
                            <span id="cart-price" class="ms-auto">
                               Price: 0
                            </span>
                        </div>
                        <form class="d-flex" role="search"> 
                            <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search"/>  <!-- Search input styled with Bootstrap. me-2 adds right margin. -->
                            <button class="btn btn-outline-success" type="submit">Search</button> <!--buttons-->
                        </form>
                    </div>
                </div>
            </nav>

            <!--cards template-->
            <template id="card-template">
                <div class="col-md-4 mb-4">
                    <div class="card h-100" style="width: 18rem;">
                        <img class="card-img-top" alt=" ">
                        <div class="card-body">
                            <h5 class="card-title">Card title</h5>
                            <p class="card-text">Card content.</p>
                            <p class="card-price fw-semibold mb-3">Card price</p>
                            <div class="d-flex gap-2">
                                <button class="btn btn-primary me-2">Add to Cart</button>
                                <button class="btn btn-outline-danger">Remove</button>
                            </div>    
                        </div>
                    </div>    
                </div>
            </template>

            <!--container, Cards will be rendered here-->
            <div class="container mt-4">
                <h2>Available Cars</h2>
                <div id="card-container" class="row"></div>
            </div>

            <script>
            
            //Array cars
            let cars = [
                {title: "BMW", description: "description", price: 100, image: "https://upload.wikimedia.org/wikipedia/commons/6/66/Safety_Car_side_2015_Malaysia.jpg", alt: "BMW"},
                {title: "Mercedes", description: "description", price: 300, image: "https://upload.wikimedia.org/wikipedia/commons/6/66/Safety_Car_side_2015_Malaysia.jpg", alt: "Mercedes"},
                {title: "Seat", description: "description", price: 500, image: "https://upload.wikimedia.org/wikipedia/commons/6/66/Safety_Car_side_2015_Malaysia.jpg", alt: "Seat"},
                {title: "Tesla", description: "description", price: 400, image: "https://upload.wikimedia.org/wikipedia/commons/6/66/Safety_Car_side_2015_Malaysia.jpg", alt: "Tesla"},
                {title: "Peugeot", description: "description", price: 200, image: "https://upload.wikimedia.org/wikipedia/commons/6/66/Safety_Car_side_2015_Malaysia.jpg", alt: "Peugeot"}
            ];

            //empty shopping cart array
            const cart = []

            //Async fetch simulator. Returns a Promise that resolves to the cars array after ~200 ms.
            function getCars() {
                return new Promise((resolve) => {
                    setTimeout(() => resolve(cars), 200);
                });
            };

            //container for the card template and deep clone
            function createCardFromTemplate (item) {
                const template = document.getElementById('card-template'); //Gets the <template> element by its id.
                const clone = template.content.cloneNode(true); //DeepClone

                const img = clone.querySelector(".card-img-top"); //clone image
                img.src = item.image;
                img.alt = item.title;

                clone.querySelector(".card-title").innerText = item.title;
                clone.querySelector(".card-text").innerText = item.description;
                clone.querySelector(".card-price").innerText = `$${Number(item.price).toFixed(2)}`; //toFixed formats the number to two decimals.

                const addButton = clone.querySelector(".btn.btn-primary"); //clone buttons
                const removeButton = clone.querySelector(".btn.btn-outline-danger");

                addButton.addEventListener("click", () => { //cart button add items. Attaches a function that runs when the button is clicked.
                    cart.push({ //adds a new item to the cart array, creates an object with title and price properties from the original item
                        title: item.title,
                        price: item.price,
                    });
                    console.log(cart);
                    updateCartDisplay(cart) //refresh the display
                });

                removeButton.addEventListener("click", () => { //cart button delete items
                    const index = cart.findIndex(cartItem => cartItem.title === item.title);
                    if (index !== -1) {
                        cart.splice(index, 1);
                        updateCartDisplay(cart)
                        console.log(cart);
                    } else {
                        console.log(cart);
                    }
                });

                return clone; // Return the node to be appended
            }

            //update cart display
            function updateCartDisplay() {
                const totalPrice = cart.reduce((sum, cartItem) => {
                return sum + cartItem.price;
                }, 0);
                document.getElementById("cart-count").textContent = `ðŸ›’ Cart: ${cart.length}`; //Finds the HTML element with id="cart-items"
                document.getElementById("cart-price").textContent = `Price: $${totalPrice.toFixed(2)}`;
            };

            //Card container
            function renderCards(items) { // Renders a list of items into #card-container
                const container = document.getElementById('card-container');
                container.innerHTML = ''; // Clears previous content to avoid duplicates.
                items.forEach((item) => { // Iterates over the provided array of items.
                    const cardElement = createCardFromTemplate(item); // Builds one card for the current item.
                    container.appendChild(cardElement);
                })
                };

            getCars().then(renderCards);// First render. Fetches data (simulated) and renders once when the Promise resolves.

            setInterval(async () => { //Periodic re-render
                const items = await getCars(); //fetch current state
                renderCards(items);
            }, 2000);

            </script>
        </body>
    </html>